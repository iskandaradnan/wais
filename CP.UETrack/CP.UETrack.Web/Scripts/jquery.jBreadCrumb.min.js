/**
 * @author Jason Roy for CompareNetworks Inc.
 * @author Steven Maglio (jquery-ui integration, http://stevenmaglio.blogspot.com/)
 * Thanks to mikejbond for suggested updates
 *
 * Version 0.3.0, improvements to be made.
 * Copyright (c) 2009 CompareNetworks Inc.
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * requires jquery-ui:
 *	jquery.ui.core.js: uses the widget factory
 *	jquery.effects.core.js: uses easing
 */
(function(d){d.widget("ui.jBreadCrumb",{_init:function(){var a=this,b=a.options,c=a.element;b.enableUiTheme&&a._enableUiThemeing(c);a._setBreadCrumbElements(a);c.addClass(b.cssClass);a._fixList(a);a._tryCompressBreadCrumb(a)},add:function(a){var b=this,c=b.element.data("breadCrumbElements");if(!a.text)throw new Error("jBreadCrumb's add function requires an options object which contains the property 'text'.");a.url=a.url||"#";a.index=a.index||c.length;a.index=a.index>c.length?c.length:a.index;a.index= a.index<1?1:a.index;b._addElement(b,a);return this},remove:function(a){var b=this,c=b.element.data("breadCrumbElements");a=a||{index:c.length-1};a.index=a.index||c.length-1;a.index++;if(!(a.index<=1)){var e=d("ul",b.element);e.find("li:nth-child("+a.index+")").remove();c.length===a.index&&e.find("li:last").addClass("last");b._setBreadCrumbElements(b);b._tryCompressBreadCrumb(b)}},clear:function(){var a=this;a.element.html("");a._setBreadCrumbElements(a)},_setBreadCrumbElements:function(a){var b=a.element; if(b.children("div").length)b=b.children("div");b=b.children("ul").children("li");a.element.data("breadCrumbElements",b);return b},_fixList:function(a){a=a.element;a.children("ul").wrap('<div style="overflow:hidden; position:relative; width:'+a.css("width")+';" />');a.children("ul").width(5E3)},_tryCompressBreadCrumb:function(a){a||(a=this);var b=a.element.data("breadCrumbElements"),c=a.options;if(b.length>0){d(b[b.length-1]).addClass("last");d(b[0]).addClass("first");c.isAnimated&&a._compressBreadCrumb(a)}}, _compressBreadCrumb:function(a){var b=a.element.data("breadCrumbElements"),c=a.options,e=d(b[b.length-1]).width(),h=c.beginingElementsToLeaveOpen,i=c.endElementsToLeaveOpen;if(e>c.maxFinalElementLength){h>0&&h--;i>0&&i--}e<c.maxFinalElementLength&&e>c.minFinalElementLength&&h>0&&h--;var f=b.length-1-i;b.each(function(g,j){a._addAnimation(g,j,a,f,h)})},_addAnimation:function(a,b,c,e,h){var i=c.options,f=d(b);if(a>h&&a<e){var g;if(f.data("events")){g=f.children("span");f.unbind("mouseover mouseout")}else{b= d("a",f);g=b.wrap("<span/>").parent();e=d('<div class="'+i.overlayClass+'" />').css({display:"block"});g.after(e);b.width(b.width()+i.breadCrumbPadding);c._isIE6OrLess()&&c._fixPNG(d("."+i.overlayClass,f).css({width:"20px",right:"-1px"}))}b={id:a,self:c};f.bind("mouseover",b,c._expandBreadCrumb).bind("mouseout",b,c._shrinkBreadCrumb);f.autoInterval=setInterval(function(){clearInterval(f.autoInterval);g.animate({width:i.previewWidth},i.timeInitialCollapse,i.easing)},150*(a-2))}else if(a>0){g=f.children("span"); b=g.length&&g.children("a")||f.children("a");a=g.length?b.width()-i.breadCrumbPadding:b.width();b.width(a);g.width(a);if(g.length){f.unbind("mouseover mouseout");f.html(b)}}},_expandBreadCrumb:function(a){var b=a.data.self.element.data("breadCrumbElements");b=d(b[a.data.id]).children("span");var c=b.children("a").width();a=a.data.self.options;b.stop();b.animate({width:c},{duration:a.timeExpansionAnimation,easing:a.easing,queue:false});return false},_shrinkBreadCrumb:function(a){var b=a.data.self.element.data("breadCrumbElements"); b=d(b[a.data.id]).children("span");a=a.data.self.options;b.stop();b.animate({width:a.previewWidth},{duration:a.timeCompressionAnimation,easing:a.easing,queue:false});return false},_isIE6OrLess:function(){return d.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent)},_fixPNG:function(a){var b;if(d(a).is("img"))b=d(a).attr("src");else{b=d(a).css("backgroundImage");b.match(/^url\(["']?(.*\.png)["']?\)$/i);b=RegExp.$1}d(a).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src='"+ b+"')"})},_enableUiThemeing:function(a){a.wrap('<div class="ui-widget" />');a.addClass("ui-widget-content ui-state-default ui-corner-all")},_addElement:function(a,b){var c=a._createNewElement(b),e=a.element.data("breadCrumbElements");if(!e.length){var h=a._createNewElement({text:"Home",url:"#"}).addClass("first last").wrap("<ul />").parent();a.element.html(h);a._fixList(a);e=a._setBreadCrumbElements(a)}h=e.length===b.index;b=d(e[b.index-1]);b.after(c);b.removeClass("last");h&&c.addClass("last");a._setBreadCrumbElements(a); a._tryCompressBreadCrumb(a)},_createNewElement:function(a){return d("<a />").text(a.text).attr({href:a.url}).wrap(d("<li />")).parent()}});d.extend(d.ui.jBreadCrumb,{version:"@VERSION",defaults:{isAnimated:true,maxFinalElementLength:400,minFinalElementLength:200,minimumCompressionElements:4,endElementsToLeaveOpen:1,beginingElementsToLeaveOpen:1,timeExpansionAnimation:800,timeCompressionAnimation:500,timeInitialCollapse:600,easing:"easeOutQuad",overlayClass:"chevronOverlay",previewWidth:5,enableUiTheme:true, cssClass:"breadCrumb",breadCrumbPadding:10}})})(jQuery);